<div class="pop-caption-box" style="z-index: 29000000;">
    <div class="pop-caption-table">
    <div class="pop-caption-cell">
        <div class="pop-caption-container" style="display:none;">
            <a href="javascript:;" class="pop-caption-close"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUNFNUNFMjZBRjE4MTFFN0JDRTBGMjFDODIzMzE5RjQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUNFNUNFMjdBRjE4MTFFN0JDRTBGMjFDODIzMzE5RjQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxQ0U1Q0UyNEFGMTgxMUU3QkNFMEYyMUM4MjMzMTlGNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxQ0U1Q0UyNUFGMTgxMUU3QkNFMEYyMUM4MjMzMTlGNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvyOTBkAAAMrSURBVHjazJpBaxNBFMfHcRO9efCmRZM0IIKHYlU8+HkWwZNtD5YqqFU8tPXSU/J5vJRSKkUpHrQmbcCLQi9NrVZ8z77BYclm35ud2cmDPzSb2cn883478yadc51OR1lxD3QZ9A20rSYzZkBXQN9BG2ma/ruY0JuXQEugm9YNW6A3oJ8TYqAOegK6a13b7Xa7r8HMoYYXqJcZExizoLegixNiYi1jQtGYl8GMRhN3QK2cDq6BVkEXIpqo0RgaOe83QffRyFRBR9cjmqnTZzcL2k2hkS+MDhsRMDM4tRhtP6OR9/RgF0WVmBXhZMcOPOxbml68Au0xbqoCMy5OGD3QC0UzFsZv0ALoa2TMJDj1ccyQjRPbCAZemGc+MyEwk+CEX/gc6Nhc0JkGJ5SZqjGT4rSQXaj1iIa/KsZMjNOoakPn3GAw2wuMWSmcOEZszHqBMCuNE9eIbabvGTMvOEmMKErlHPOZQcxWCBkfOPXG4SQ1oujb4GLWoIHWS+J0wMmE1IhthoNZi9CpO+I0oMnmmDs4LZxlJJiZzJjg4rQPegw6kgwscZgyTWbWaLYaF4jQsvU3ByfMxFA6KK3cQoLZDImL09BlQK5GpJgFwcmXEels5h0nn0akmHnFybcRg9kj2m1yYwf0sAxOIYy4xB+fnfkygovdOnN2smez9ZwKIIoRSe2Ut2jWYhuR1E7jFs3VspnRJU1wayeX2qwSIxKcPoI+hMZMB8YJFzv8BX2RuWg6Y6YD4mQWOxNltgBejUhwGlU7uWwBar6NSHHKKzsktZkIMx0Ip2HAnaaTkSTQzs4Fs8TVSOIJJx9bgCb9OpNIjRgT04FLcQlm7XGZ0TkmVpgmSu/sLMz2GW2naWzni4wYE+2qdnZWZuapT6fM6BE4tQPjlBdD6nPgYkZHwikvjqhvNmbdbjexjSxGwKkoM1zMnhojt9TZGZQYOPnAbBaychuN3IiMkw/M2prh+qDCTLhi1kcjmyr/X2yDiCa4mOFiuolGTkHPQJ8yDbYj4FSEWfaExi5oKU3TUzMPH1Kp8ED9P3i2oSYrMDPP1dnxq6ugH6B35uDZXwEGAACjB9j1RlU2AAAAAElFTkSuQmCC"></a>
    <style>
        .pop-caption-box {
            position: fixed;
            width: 100%;
            height: 100%;
            top:0;
            left: 0;
            z-index: 100;
            background: rgba(0,0,0,.2);
        }
        .pop-caption-table {
            display: table;
            width: 100%;
            height: 100%;
        }
        .pop-caption-cell {
            display: table-cell;
            vertical-align: middle;
            text-align: center;
        }
        .pop-caption-container {
            background: rgba(255,255,255,1);
            display: inline-block;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            padding: 10px;
            position: relative;
        }
        .pop-caption-close {
            position: absolute;
            right: -5%;
            top: -6%;
            width: 25px;
            height: 25px;
            background: rgba(255,255,255,1);
            border-radius: 50%;
        }
        .pop-caption-close img{
            width: 45%;
            vertical-align: middle;
        }
    </style>
<script type="text/javascript" src="__STATIC__/verify/js/y_drag.js"></script>
<div id="pop-caption"></div>
<script>
    $.ajax({
        "url": "{:url('user/caption/init')}", // 获取初始的验证码 `css + 验证码图片` 的地址
        "success": function(html) {
            var close = function (parent) {
                parent.delay(300).fadeOut(1000);
                setTimeout(function () {
                    parent.remove();
                },1000);
            };
            var id = '{$id}';
            var parent = $("#pop-caption").html(html).closest('.pop-caption-box');  // 填充  `css + 验证码图片`
            parent.find('.pop-caption-container').show();
            $('.pop-caption-close').click(function () {
                close($(this).closest('.pop-caption-box'));
            });
            $(this).y_drag({
                "id":"#pop-caption",
                "verify_url": "{:url('user/caption/check')}",
                "source_url": "{:url('user/caption/captchar')}",
                "key":'{$key|default=""}',
                "success": function (data) {
                    close(parent);
                    if(typeof caption_callback_function === "function"){
                        caption_callback_function(data.tag,data.token);
                    }else{
                        console.log('未定义回调函数caption_callback_function');
                    }
                }
            });
        }
    });
</script>
        </div></div></div></div>
